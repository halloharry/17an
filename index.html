<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Form Pendaftaran Lomba 17an</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka&display=swap" rel="stylesheet">

    <style>
        body {
          font-family: 'Fredoka', sans-serif;
          background: linear-gradient(to bottom right, #fff3f3, #ffecec);
          min-height: 100vh;
          display: flex;
          flex-direction: column;
        }
        header {
          background: linear-gradient(to right, red, white);
          padding: 1rem;
          text-align: center;
          color: white;
          font-weight: bold;
          font-size: 1.5rem;
        }
        footer {
          background-color: #dc3545;
          color: white;
          text-align: center;
          padding: 0.8rem;
          margin-top: auto;
        }
        .card {
          border-left: 10px solid red;
        }
        .independence-banner {
          background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/9/94/Flag-map_of_Indonesia.svg/1280px-Flag-map_of_Indonesia.svg.png') no-repeat center right;
          background-size: 100px;
          padding-right: 120px;
        }
    </style>

    <script>
        // üîê Proteksi halaman - jika belum login, tampilkan form login
        if (localStorage.getItem("loggedIn") !== "true") {
          document.addEventListener("DOMContentLoaded", function () {
            document.body.innerHTML = `
              <div class="container mt-5">
                <div class="card p-4 shadow-lg mx-auto" style="max-width: 400px;">
                  <h2 class="mb-4 text-center text-danger">Login Panitia</h2>
                  <form id="loginForm">
                    <div class="mb-3">
                      <label>Username</label>
                      <input type="text" class="form-control" id="username" required />
                    </div>
                    <div class="mb-3">
                      <label>Password</label>
                      <input type="password" class="form-control" id="password" required />
                    </div>
                    <button class="btn btn-danger w-100">Login</button>
                  </form>
                  <div id="loginError" class="text-danger text-center mt-3 d-none">Username atau password salah!</div>
                </div>
              </div>
            `;

            document.getElementById("loginForm").addEventListener("submit", function (e) {
              e.preventDefault();
              const user = document.getElementById("username").value;
              const pass = document.getElementById("password").value;
              if (user === "admin" && pass === "P@ssw0rd") {
                localStorage.setItem("loggedIn", "true");
                location.reload();
              } else {
                document.getElementById("loginError").classList.remove("d-none");
              }
            });
          });
        }
    </script>
</head>

<body>
<header style="background-image: url('https://fahum.umsu.ac.id/info/wp-content/uploads/2023/08/kemerdekaan-indonesia-upaya-dan-faktor-pendukungnya.jpg'); background-size: cover; background-position: center; color: white; padding: 3rem; text-align: center"
        class="d-flex justify-content-center align-items-center gap-3 p-3 bg-light border-bottom">
    <img src="https://upload.wikimedia.org/wikipedia/commons/9/9f/Flag_of_Indonesia.svg" height="40" alt="11">
    <h1 class="m-0 fs-2 text-white fw-bold">Pendaftaran Lomba 17 Agustus Antar RT</h1>
    <img src="https://upload.wikimedia.org/wikipedia/commons/9/9f/Flag_of_Indonesia.svg" height="40" alt="11">
</header>

<div class="container my-5">
    <div class="card shadow-lg rounded-4 p-4 independence-banner">
        <h2 class="mb-4 text-center text-danger">Formulir Pendaftaran</h2>
        <form id="lombaForm">
            <div class="mb-3">
                <label class="form-label">Nama Lengkap</label>
                <input type="text" name="entry.2094351097" class="form-control" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Usia</label>
                <input type="number" name="entry.107278371" class="form-control" required min="1" max="99"
                       oninput="this.value = this.value.slice(0, 2)">
            </div>

            <div class="mb-3">
                <label class="form-label">RT</label>
                <select name="entry.453818273" class="form-select" required>
                    <option value="">-- Pilih RT --</option>
                    <option value="RT 02">RT 02</option>
                    <option value="RT 03">RT 03</option>
                    <option value="RT 04">RT 04</option>
                    <option value="RT 05">RT 05</option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Lomba yang Diikuti</label>
                <select name="entry.727121773" class="form-select" required>
                    <option value="">-- Pilih Lomba --</option>
                    <option value="Balap Karung">Balap Karung</option>
                    <option value="Makan Kerupuk">Makan Kerupuk</option>
                    <option value="Tarik Tambang">Tarik Tambang</option>
                    <option value="Kelereng">Kelereng</option>
                    <option value="Lomba Karaoke">Lomba Karaoke</option>
                    <option value="Tidak Ikut Serta">Tidak Ikut Serta</option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">No HP (Opsional)</label>
                <input type="text" name="entry.1311942718" class="form-control" pattern="^\d{10,14}$" minlength="10"
                       maxlength="14" placeholder="Contoh: 081234567890">
            </div>

            <button type="submit" class="btn btn-danger w-100 fw-bold">Kirim Pendaftaran</button>
        </form>

        <div id="pesanBerhasil" class="alert alert-success mt-4 d-none text-center fw-bold">
            üéâ Terima kasih sudah mendaftar! Sampai jumpa di hari H !
            <br>
            <a id="whatsappLink" href="#" class="btn btn-success mt-3" target="_blank">Konfirmasi via WhatsApp</a>
        </div>


        <div class="text-end mt-4">
            <button class="btn btn-outline-danger btn-sm" onclick="logout()">Logout</button>
        </div>
    </div>
</div>

<footer class="d-flex justify-content-center align-items-center gap-3 p-3 bg-danger text-white mt-5 rounded-3 shadow-sm">
    <span>&copy; 2025 Pixel Playground Studio</span>
    <img src="https://upload.wikimedia.org/wikipedia/commons/9/9f/Flag_of_Indonesia.svg" alt="Bendera Indonesia"
         height="30">
</footer>

<script>
    document.getElementById("lombaForm")?.addEventListener("submit", function (e) {
      e.preventDefault();
      const form = e.target;
      const data = new FormData(form);

      fetch("https://docs.google.com/forms/d/e/1FAIpQLSf6MGzYONvg79OXFz6GzdpjXaLcvsG_Ybi2shUU_gENKahROQ/formResponse", {
        method: "POST",
        mode: "no-cors",
        body: data
      }).then(() => {
        form.classList.add("d-none");
        document.getElementById("pesanBerhasil").classList.remove("d-none");

        const nama = data.get("entry.2094351097"); // Nama
        const lomba = data.get("entry.727121773"); // Lomba
        const noHp = data.get("entry.1311942718"); // No HP

        if (noHp) {
            const nomorWa = noHp.replace(/^0/, '62'); // Ubah 08xx ‚Üí 62xx
            const pesan = `Halo ${nama}, kamu telah terdaftar dalam lomba ${lomba}. Sampai jumpa di acara 17an ya!`;
            const waLink = `https://wa.me/${nomorWa}?text=${encodeURIComponent(pesan)}`;
            document.getElementById("whatsappLink").href = waLink;
            document.getElementById("whatsappLink").classList.remove("d-none");
        } else {
            document.getElementById("whatsappLink").classList.add("d-none");
        }

      }).catch(() => {
        alert("Gagal mengirim. Coba lagi!");
      });
    });

    function logout() {
      localStorage.removeItem("loggedIn");
      location.reload();
    }
</script>
</body>
</html>
